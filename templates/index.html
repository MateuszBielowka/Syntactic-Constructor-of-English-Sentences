<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constructor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.12/codemirror.min.css">
    <link rel="stylesheet" href="../static/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="../static/scripts.js"></script>
</head>

<body>
    <main id="wrapper">
        <h1>Konstruktor angielskich zdań</h1>
        {#OSOBA I LICZBA#}
        <section id="subject_section">
            <h2>Wybierz podmiot</h2>
            <form class="container" id="subject_form">
                <div class="row">
                    <div class="col-2 header">
                        Osoba
                    </div>
                    <div class="col-5 header">
                        Liczba pojedyncza
                    </div>
                    <div class="col-5 header">
                        Liczba mnoga
                    </div>
                </div>

                <div class="row">
                    <div class="col-2 header">
                        1
                    </div>
                    <div class="col-5">
                        <input type="radio" id="i" name="noun" value="i" class="radio-form">
                        <label for="i" class="btn-primary" id="first">I</label>
                    </div>
                    <div class="col-5">
                        <input type="radio" id="we" name="noun" value="we" class="radio-form">
                        <label for="we" class="btn-primary">we</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-2 header">
                        2
                    </div>
                    <div class="col-5">
                        <input type="radio" id="thou" name="noun" value="you" class="radio-form">
                        <label for="thou" class="btn-primary">you</label>
                    </div>
                    <div class="col-5">
                        <input type="radio" id="you" name="noun" value="you" class="radio-form">
                        <label for="you" class="btn-primary">you</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-2 header">3</div>
                    <div class="col-5" id="third_person">
                        <label for="toggle_person" class="btn-primary">he / she / it</label>
                        <input type="radio" id="toggle_person" name="noun" value="he" class="radio-form">
                        <div id="person_form">
                            <label for="person_dropdown"></label>
                            <select name="person" id="person_dropdown">
                                <option value="he">he</option>
                                <option value="she">she</option>
                                <option value="it">it</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-5">
                        <input type="radio" id="they" name="noun" value="they" class="radio-form">
                        <label for="they" class="btn-primary">they</label>
                    </div>
                </div>
                <div class="row">
                    {#RZECZOWNIK#}
                    <div class="col-2 header">Rzeczownik</div>
                    <div class="col-5" id="noun">
                        <label for="toggle_noun" class="btn-primary">Rzeczownik</label>
                        <input type="radio" id="toggle_noun" name="noun" value="noun" class="radio-form">
                        <div id="noun_form">
                            <label for="noun_dropdown"></label>
                            <select name="noun" id="noun_dropdown"></select>
                        </div>
                    </div>
                    <div class="col-5 liczba_mnoga">
                        <label for="toggle_plural_subject" class="btn-primary">Liczba mnoga</label>
                        <input id="toggle_plural_subject" type="checkbox" class="checkbox-form">
                    </div>
                </div>
                <input type="hidden" id="subject_value" name="subject">
                <input type="submit" value="Submit">
            </form>
        </section>


        {#CZASOWNIK#}
        <section id="verb_section">
            <form id="verb_form">
                <label for="verb_dropdown">Wybierz czasownik:</label>
                <select name="cars" id="verb_dropdown"></select>
                <input type="submit" value="Submit">
            </form>
        </section>

        {#ZAIMEK#}
        <section id="pronoun_section">
            <label for="toggle_pro" class="btn-primary">Użyj zaimka dzierżawczego lub wskazującego</label>
            <input id="toggle_pro" type="checkbox">
            <form id="pronoun_form">
                <label for="pronoun_dropdown">Wybierz zaimek:</label>
                <select name="pronouns" id="pronoun_dropdown"></select>
                <input type="submit" value="Submit">
            </form>
        </section>


        {#PRZYMIOTNIK#}
        <section id="adjective_section">
            <label for="toggle_adj" class="btn-primary">Użyj przymiotnika</label>
            <input id="toggle_adj" type="checkbox">
            <form id="adjective_form">
                <label for="adjective_dropdown">Wybierz przymiotnik:</label>
                <select name="adjectives" id="adjective_dropdown"></select>
                <input type="submit" value="Submit">
            </form>
        </section>

        {#DOPEŁNIENIE#}
        <section id="object_section">
            <form id="object_form">
                <label for="object_dropdown">Wybierz dopełnienie:</label>
                <select name="objects" id="object_dropdown"></select>
                <div class="liczba_mnoga">
                    <label for="toggle_plural_object" class="btn-primary">Liczba mnoga</label>
                    <input id="toggle_plural_object" type="checkbox" class="checkbox-form">
                </div>
                <input type="submit" value="Submit">
            </form>
        </section>

        {#CZAS#}
        <section id="tense_section">
            <form id="tense_form">
                <label for="tense_dropdown">Wybierz czas:</label>
                <select name="cars" id="tense_dropdown"></select>
                <input type="submit" value="Submit">
            </form>
        </section>

        {#RODZAJ_ZDANIA#}
        <section id="sentence_kind_section">
            <form id="sentence_kind_form">
                <label for="sentence_kind_dropdown">Wybierz rodzaj zdania:</label>
                <select name="cars" id="sentence_kind_dropdown"></select>
                <input type="submit" value="Submit">
            </form>
        </section>

        <section id="sending_section">
            <button onclick="sendData()" id="send_button">Send Data</button>
        </section>

        <section id="output_section">
            <h2>Wygenerowane zdanie</h2>
            <div id="output"></div>
        </section>
    </main>




    <script>
        async function readJSON(appRoute, query) {
            const response = await fetch(appRoute);
            const data = await response.json();

            const select = document.querySelector(query);
            select.innerHTML = "";

            data.forEach(word => {
                const option = document.createElement("option");
                option.innerHTML = `<option>${word}</option>`;
                select.appendChild(option);
            });
        }

        readJSON("/api/noun_list", "#noun_form select");
        readJSON("/api/noun_list", "#object_form select");
        readJSON("/api/verb_list", "#verb_form select");
        readJSON("/api/pronoun_list", "#pronoun_form select");
        readJSON("/api/adjective_list", "#adjective_form select");
        readJSON("/api/tense_list", "#tense_form select");
        readJSON("/api/sentence_kind_list", "#sentence_kind_form select");
    </script>
    <script>
        function getSubjectValue() {
            // if "Rzeczownik" radio is selected -> return selected noun
            const nounRadio = document.getElementById('toggle_noun');
            if (nounRadio && nounRadio.checked) {
                return document.getElementById('noun_dropdown').value || "";
            }

            // if the "he / she / it" radio is selected, use the person_dropdown selection
            const checked = document.querySelector('input[name="noun"]:checked');
            if (checked.id === 'toggle_person') {
                return document.getElementById('person_dropdown').value || "";
            }

            // otherwise return the radio's value (i, you, we, they, etc.)
            return checked.value || "";
        }

        function getAdjectiveValue() {
            const adjCheckbox = document.getElementById('toggle_adj');
            if (adjCheckbox && adjCheckbox.checked) {
                return document.getElementById('adjective_dropdown').value;
            } else return "null";
        }

        function getPronounValue() {
            const proCheckbox = document.getElementById('toggle_pro');
            if (proCheckbox && proCheckbox.checked) {
                return document.getElementById('pronoun_dropdown').value;
            } else return "null";
        }

        function translateSentenceKind() {
            const value = document.getElementById('sentence_kind_dropdown').value;

            const translationMap = {
                "Zdanie twierdz\u0105ce": "Affirmative Sentence",
                "Zdanie pytaj\u0105ce": "Interrogative Sentence",
                "Zdanie przecz\u0105ce": "Negative Sentence",
                "Tryb rozkazuj\u0105cy": "Imperative Mood"
            };

            return translationMap[value] || value;
        }

        function getPluralSubject() {
            const pluralCheckbox = document.getElementById('toggle_plural_subject');
            if (pluralCheckbox && pluralCheckbox.checked) {
                return "true";
            } else return "false";
        }

        function getPluralObject() {
            const pluralCheckbox = document.getElementById('toggle_plural_object');
            if (pluralCheckbox && pluralCheckbox.checked) {
                return "true";
            } else return "false";
        }

    </script>

    <script>
        function sendData() {
            const dict = {
                subject: getSubjectValue(),
                plural_subject: getPluralSubject(),
                verb: document.getElementById('verb_dropdown').value,
                object: document.getElementById('object_dropdown').value,
                plural_object: getPluralObject(),
                tense: document.getElementById('tense_dropdown').value,
                sentence_kind: translateSentenceKind(),
                adjective: getAdjectiveValue(),
                pronoun: getPronounValue()
            };

            $.ajax({
                url: '/process',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(dict),
                success: function (response) {
                    if (response.result) {
                        document.getElementById('output').textContent = response.result;
                    } else {
                        document.getElementById('output').textContent = JSON.stringify(response, null, 2);
                    }
                },
                error: function (error) {
                    console.log(error);
                    alert("Nie udało się wysłać danych. Sprawdź konsolę.");
                }
            });
        }

    </script>
</body>

</html>